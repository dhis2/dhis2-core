ARG POSTGRES_BASE_IMAGE=ghcr.io/baosystems/postgis:14-3.5
ARG DHIS2_DB_DUMP_URL

FROM busybox AS downloader
ARG DHIS2_DB_DUMP_URL
WORKDIR /tmp
RUN wget --output-document dump.sql.gz "$DHIS2_DB_DUMP_URL"

FROM ${POSTGRES_BASE_IMAGE}

ENV POSTGRES_USER=dhis \
    POSTGRES_DB=dhis \
    POSTGRES_PASSWORD=dhis \
    PGUSER=dhis \
    PGDATABASE=dhis \
    PGPASSWORD=dhis

COPY --from=downloader /tmp/dump.sql.gz /docker-entrypoint-initdb.d/
